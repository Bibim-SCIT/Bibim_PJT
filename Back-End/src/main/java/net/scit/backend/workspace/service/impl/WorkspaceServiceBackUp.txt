
//     package net.scit.backend.workspace.service.impl;

// import java.util.ArrayList;
// import java.util.Arrays;
// import java.util.List;
// import java.util.Optional;
// import java.util.Random;
// import java.util.concurrent.TimeUnit;

// import org.springframework.data.redis.core.RedisTemplate;
// import org.springframework.stereotype.Service;
// import org.springframework.util.StringUtils;
// import org.springframework.web.multipart.MultipartFile;

// import jakarta.transaction.Transactional;
// import lombok.RequiredArgsConstructor;
// import lombok.extern.slf4j.Slf4j;
// import net.scit.backend.auth.AuthUtil;
// import net.scit.backend.common.ResultDTO;
// import net.scit.backend.common.SuccessDTO;
// import net.scit.backend.component.MailComponents;
// import net.scit.backend.component.S3Uploader;
// import net.scit.backend.exception.CustomException;
// import net.scit.backend.exception.ErrorCode;
// import net.scit.backend.member.entity.MemberEntity;
// import net.scit.backend.member.repository.MemberRepository;
// import net.scit.backend.workspace.dto.InvateWorkspaceDTO;
// import net.scit.backend.workspace.dto.WorkspaceDTO;
// import net.scit.backend.workspace.entity.WorkspaceChannelEntity;
// import net.scit.backend.workspace.entity.WorkspaceChannelRoleEntity;
// import net.scit.backend.workspace.entity.WorkspaceEntity;
// import net.scit.backend.workspace.entity.WorkspaceMemberEntity;
// import net.scit.backend.workspace.repository.WorkspaceChannelRepository;
// import net.scit.backend.workspace.repository.WorkspaceChannelRoleRepository;
// import net.scit.backend.workspace.repository.WorkspaceMemberRepository;
// import net.scit.backend.workspace.repository.WorkspaceRepository;
// import net.scit.backend.workspace.service.WorkspaceService;

// @Service
// @RequiredArgsConstructor
// @Slf4j
// public class WorkspaceServiceImpl implements WorkspaceService {

//     private final WorkspaceRepository workspaceRepository;
//     private final WorkspaceMemberRepository workspaceMemberRepository;
//     private final MemberRepository memberRepository;
//     private final WorkspaceChennelRoleRepository workspaceRoleRepository;
//     private final WorkspaceChennelRepository workspaceChennelRepository;

//     private final RedisTemplate<String, String> redisTemplate;
//     private final MailComponents mailComponents;
//     private final S3Uploader s3Uploader;

//     // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ˆëŒ€ ìœ íš¨ ê¸°ê°„
//     private static final Long MAIL_EXPIRES_IN = 300000L;

//     /**
//      * ëœë¤ UUID ìƒì„±ì„ ìœ„í•œ static ë©”ì†Œë“œ
//      * 
//      * @return ìƒì„±í•œ UUIDë¥¼ ë¬¸ìì—´ë¡œ ë³€ê²½ í›„ ë°˜í™˜
//      */
//     public static String generateRandomUUID() {
//         Random random = new Random();
//         int randomNumber = random.nextInt(900000) + 100000; // 6ìë¦¬ ìˆ«ì ìƒì„± (100000ë¶€í„° 999999ê¹Œì§€)
//         return String.valueOf(randomNumber);
//     }

//     /**
//      * ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ìƒì„± ë©”ì†Œë“œ
//      * 
//      * @param workspaceDTO ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ëŒ€í•œ ì •ë³´
//      * @return ê²°ê³¼ í™•ì¸ ë©”ì„¸ì§€
//      */
//     @Override
//     @Transactional
//     public ResultDTO<SuccessDTO> workspaceCreate(WorkspaceDTO workspaceDTO, MultipartFile file) {
//         // í”„ë¡œí•„ ì´ë¯¸ì§€
//         String imageUrl = null;
//         if (file != null && !file.isEmpty()) { // âœ… fileì´ nullì¸ì§€ ë¨¼ì € ì²´í¬í•œ í›„ isEmpty() í™•ì¸
//             // íŒŒì¼ ì´ë¦„ì—ì„œ í™•ì¥ì ì¶”ì¶œ
//             String fileExtension = StringUtils.getFilenameExtension(file.getOriginalFilename());
//             // ì§€ì›í•˜ëŠ” ì´ë¯¸ì§€ íŒŒì¼ í™•ì¥ì ëª©ë¡
//             List<String> allowedExtensions = Arrays.asList("jpg", "jpeg", "png", "gif");
//             // í™•ì¥ìê°€ ì´ë¯¸ì§€ íŒŒì¼ì¸ì§€ í™•ì¸
//             if (fileExtension != null && allowedExtensions.contains(fileExtension.toLowerCase())) {
//                 try { // ì´ë¯¸ì§€ ì—…ë¡œë“œí•˜ê³  url ê°€ì ¸ì˜¤ê¸°
//                     imageUrl = s3Uploader.upload(file, "workspace-images");
//                     log.info("âœ… ì—…ë¡œë“œ ì™„ë£Œ: {}", imageUrl);
//                 } catch (Exception e) {
//                     log.error(e.getMessage(), e);
//                     log.error("âŒ S3 ì—…ë¡œë“œ ì‹¤íŒ¨: {}", e.getMessage());
//                     throw new CustomException(ErrorCode.FAILED_IMAGE_SAVE);
//                 }
//             } else {
//                 // ì´ë¯¸ì§€ íŒŒì¼ì´ ì•„ë‹Œ ê²½ìš°ì— ëŒ€í•œ ì²˜ë¦¬
//                 log.warn("âš ï¸ íŒŒì¼ì´ ì—†ìœ¼ë¯€ë¡œ ê¸°ë³¸ í”„ë¡œí•„ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.");
//                 throw new CustomException(ErrorCode.UN_SUPPORTED_IMAGE_TYPE);
//             }
//         }
//         log.info("ğŸ“ ìµœì¢… ì €ì¥í•  ì´ë¯¸ì§€ URL: {}", imageUrl);

//         // ìƒˆë¡œìš´ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ìƒì„±
//         WorkspaceEntity workspaceEntity;
//         workspaceEntity = WorkspaceEntity.builder()
//                 .wsName(workspaceDTO.getWsName())
//                 .wsImg(imageUrl)
//                 .build();
//         workspaceEntity = workspaceRepository.saveAndFlush(workspaceEntity);

//         // ì±„ë„ì˜ ê¸°ë³¸ ì—­í• ì„ ì¶”ê°€í•¨
//         WorkspaceChannelRoleEntity workspaceRoleEntity = WorkspaceChannelRoleEntity.builder()
//                 .workspace(workspaceEntity).build();
//         workspaceRoleRepository.saveAndFlush(workspaceRoleEntity);

//         // í˜„ì¬ ë¡œê·¸ì¸í•œ ìœ ì € ì´ë©”ì¼ì„ ê°€ì ¸ì˜´
//         String email = AuthUtil.getLoginUserId();

//         // í˜„ì¬ ë¡œê·¸ì¸í•œ ìœ ì €ì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜´
//         MemberEntity memberEntity = memberRepository.findById(email).get();

//         // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë©¤ë²„ ì—”í‹°í‹°ì— ë°ì´í„°ë¥¼ ì €ì¥
//         WorkspaceMemberEntity workspaceMemberEntity = WorkspaceMemberEntity.builder()
//                 .member(memberEntity)
//                 .workspace(workspaceEntity)
//                 .chRoleNumber(workspaceRoleEntity)
//                 .nickname(memberEntity.getName())
//                 .profileImage(memberEntity.getProfileImage())
//                 .build();
//         workspaceMemberRepository.save(workspaceMemberEntity);

//         // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì±„ë„ ìƒì„±
//         WorkspaceChannelEntity workspaceChannelEntity = WorkspaceChannelEntity.builder()
//                 .workspace(workspaceEntity)
//                 .workspaceRole(null)
//                 .channelName("ìƒˆ ì±„ë„")
//                 .build();
//         workspaceChennelRepository.save(workspaceChannelEntity);
//         // ì„±ê³µì‹œ DTO ì €ì¥
//         SuccessDTO successDTO = SuccessDTO.builder()
//                 .success(true)
//                 .build();
//         // ê²°ê³¼ ë°˜í™˜
//         return ResultDTO.of("ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ìƒì„±ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.", successDTO);

//     }

//     /**
//      * ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì‚­ì œ ë©”ì†Œë“œ
//      * 
//      * @param wsName ì‚­ì œí•  ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„
//      */
//     @Override
//     public ResultDTO<SuccessDTO> workspaceDelete(String wsName) {
//         // í˜„ì¬ ë¡œê·¸ì¸ í•œ ì´ë©”ì¼ì„ ë°›ìŒìŒ
//         String email = AuthUtil.getLoginUserId();
//         // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ id ê²€ìƒ‰
//         Long wsId = workspaceRepository.findWsIdByWsNameAndEmail(wsName, email);
//         WorkspaceEntity w = workspaceRepository.findById(wsId).get();
//         // ì‚¬ì§„ ì‚­ì œ
//         s3Uploader.deleteFile(w.getWsImg());
//         // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì‚­ì œ
//         workspaceRepository.deleteById(wsId);
//         // ì„±ê³µì‹œ DTO ì €ì¥
//         SuccessDTO successDTO = SuccessDTO.builder()
//                 .success(true)
//                 .build();
//         // ê²°ê³¼ ë°˜í™˜
//         return ResultDTO.of("ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì‚­ì œì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.", successDTO);
//     }

//     /**
//      * ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë°˜í™˜ ë©”ì†Œë“œ
//      * 
//      * @return í•´ë‹¹ ë©¤ë²„ì˜ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¦¬ìŠ¤íŠ¸
//      */
//     @Override
//     public List<WorkspaceDTO> workspaceList() {
//         // í˜„ì¬ ë¡œê·¸ì¸í•œ ì•„ì´ë”” í™•ì¸
//         String email = AuthUtil.getLoginUserId();
//         // í•´ë‹¹ ìœ ì €ê°€ ì°¸ì—¬ì¤‘ì¸ ëª¨ë“  ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ê²€ìƒ‰
//         List<WorkspaceMemberEntity> workspaceMemberEntities = workspaceMemberRepository.findAllByMemberEmail(email);
//         // ëª¨ë“  ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë¦¬ìŠ¤íŠ¸
//         List<WorkspaceDTO> workspaceDTOs = new ArrayList<>();
//         if (workspaceMemberEntities.size() == 0) {
//             // ê²°ê³¼ ë°˜í™˜
//             // ì˜ˆì™¸ ì²˜ë¦¬
//         }

//         workspaceMemberEntities.forEach((e) -> {
//             workspaceDTOs.add(WorkspaceDTO.toDTO(workspaceRepository.findById(e.getWorkspace().getWsId()).get()));
//         });

//         // ê²°ê³¼ ë°˜í™˜
//         return workspaceDTOs;
//     }

//     /**
//      * íŒŒì¼ì´ ìˆëŠ” ê²½ìš°
//      * 
//      * @param wsName
//      * @param file
//      * @return
//      */
//     @Override
//     public ResultDTO<SuccessDTO> workspaceUpdate(String wsName, String newName, MultipartFile file) {
//         String email = AuthUtil.getLoginUserId();
//         Long wsId = workspaceRepository.findWsIdByWsNameAndEmail(wsName, email);
//         WorkspaceEntity workspaceEntity = workspaceRepository.findById(wsId).get();
//         // // í”„ë¡œí•„ ì´ë¯¸ì§€
//         // String imageUrl = null;
//         // if (file != null && !file.isEmpty()) { // âœ… fileì´ nullì¸ì§€ ë¨¼ì € ì²´í¬í•œ í›„ isEmpty()
//         // í™•ì¸
//         // // íŒŒì¼ ì´ë¦„ì—ì„œ í™•ì¥ì ì¶”ì¶œ
//         // String fileExtension =
//         // StringUtils.getFilenameExtension(file.getOriginalFilename());
//         // // ì§€ì›í•˜ëŠ” ì´ë¯¸ì§€ íŒŒì¼ í™•ì¥ì ëª©ë¡
//         // List<String> allowedExtensions = Arrays.asList("jpg", "jpeg", "png", "gif");
//         // // í™•ì¥ìê°€ ì´ë¯¸ì§€ íŒŒì¼ì¸ì§€ í™•ì¸
//         // if (fileExtension != null &&
//         // allowedExtensions.contains(fileExtension.toLowerCase())) {
//         // try { // ì´ë¯¸ì§€ ì—…ë¡œë“œí•˜ê³  url ê°€ì ¸ì˜¤ê¸°
//         // String oldfile_name = workspaceEntity.getWsImg();
//         // s3Uploader.deleteFile(oldfile_name);
//         // imageUrl = s3Uploader.upload(file, "workspace-images");
//         // log.info("âœ… ì—…ë¡œë“œ ì™„ë£Œ: {}", imageUrl);
//         // } catch (Exception e) {
//         // log.error(e.getMessage(), e);
//         // log.error("âŒ S3 ì—…ë¡œë“œ ì‹¤íŒ¨: {}", e.getMessage());
//         // throw new CustomException(ErrorCode.FAILED_IMAGE_SAVE);
//         // }
//         // } else
//         // {
//         // workspaceEntity.setWsName(newName);
//         // workspaceRepository.save(workspaceEntity);

//         // // ì„±ê³µì‹œ DTO ì €ì¥
//         // SuccessDTO successDTO = SuccessDTO.builder()
//         // .success(true)
//         // .build();
//         // // ê²°ê³¼ ë°˜í™˜
//         // return ResultDTO.of("ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ ë³€ê²½ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.", successDTO);
//         // }
//         // }
//         // log.info("ğŸ“ ìµœì¢… ì €ì¥í•  ì´ë¯¸ì§€ URL: {}", imageUrl);
//         workspaceEntity.setWsName(newName);
//         // workspaceEntity.setWsImg(imageUrl);
//         // log.info("===={}",workspaceEntity.toString());
//         workspaceRepository.save(workspaceEntity);
//         // ì„±ê³µì‹œ DTO ì €ì¥
//         SuccessDTO successDTO = SuccessDTO.builder()
//                 .success(true)
//                 .build();
//         // ê²°ê³¼ ë°˜í™˜
//         return ResultDTO.of("ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ë° ì‚¬ì§„ ë³€ê²½ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.", successDTO);
//     }

//     /**
//      * ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ˆëŒ€
//      * 
//      * @param wsName
//      * @param email
//      */
//     @Override
//     public ResultDTO<SuccessDTO> workspaseInvate(Long wsId, String email) {

//         // í˜„ì¬ ë¡œê·¸ì¸í•œ ì•„ì´ë”” í™•ì¸
//         String e = AuthUtil.getLoginUserId();

//         // ì´ˆëŒ€ ë³´ë‚´ë ¤ê³  í•˜ëŠ” ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„
//         String wsName = workspaceRepository.findById(wsId).get().getWsName();

//         // í˜„ì¬ ìœ ì €ê°€ bibim ì— ê°€ì… ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
//         if (memberRepository.findById(email).isEmpty()) {
//             SuccessDTO successDTO = SuccessDTO.builder()
//                     .success(false)
//                     .build();
//             // ê²°ê³¼ ë°˜í™˜
//             return ResultDTO.of(" ì¡´ì¬ í•˜ì§€ ì•ŠëŠ” íšŒì›ì…ë‹ˆë‹¤.", successDTO);
//         }

//         // 0. í•´ë‹¹ ìœ ì €ê°€ ì´ë¯¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì— ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
//         if (!workspaceMemberRepository.findByWorkspace_wsIdAndMember_Email(wsId, email).isEmpty()) {
//             SuccessDTO successDTO = SuccessDTO.builder()
//                     .success(false)
//                     .build();
//             // ê²°ê³¼ ë°˜í™˜
//             return ResultDTO.of("ì´ë¯¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì— ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.", successDTO);
//         }

//         // email ì–‘ì‹
//         String title = "BIBIM ìƒˆë¡œìš´ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ " + wsName + "ì´ˆëŒ€ ë˜ì—ˆìŠµë‹ˆë‹¤!";
//         String code = generateRandomUUID();
//         String message = "<h3>5ë¶„ì•ˆì— ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</h3> <br>" +
//                 "<h1>" + code + "</h1>";
//         // ë³´ë‚´ê¸°ì „ì— ê¸°ì¡´ì— ë³´ë‚¸ ì½”ë“œê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  Redisì—ì„œ ì‚­ì œ í›„ ë©”ì¼ ì „ì†¡
//         if (redisTemplate.opsForValue().get("newWorkspace: " + email) != null) {
//             redisTemplate.delete("newWorkspace: " + email);
//         }
//         // mailcomponentì˜ sendmail ë©”ì†Œë“œë¥¼ í†µí•´ í•´ë‹¹ email ì£¼ì†Œì— ë©”ì¼ì„ ì „ì†¡
//         mailComponents.sendMail(email, title, message);

//         // redisì— uuidë¥¼ ì„ì‹œ ì €ì¥
//         // redisTemplate.opsForValue()
//         // .set("signup: " + email, code, MAIL_EXPIRES_IN, TimeUnit.MILLISECONDS);
//         try {
//             redisTemplate.opsForValue()
//                     .set("newWorkspace: " + email, code, MAIL_EXPIRES_IN, TimeUnit.MILLISECONDS);
//         } catch (Exception ex) {
//             log.error("âŒ Redis ì €ì¥ ì‹¤íŒ¨: {}", ex.getMessage());
//             throw new CustomException(ErrorCode.REDIS_CONNECTION_FAILED);
//         }

//         SuccessDTO successDTO = SuccessDTO.builder()
//                 .success(true)
//                 .build();
//         return ResultDTO.of("ë©”ì¼ì„ ë³´ë‚´ëŠ” ê²ƒì„ ì„±ê³µí–ˆìŠµë‹ˆë‹¤.", successDTO);
//     }

//     /**
//      * ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ˆëŒ€ ìˆ˜ë½ ë©”ì†Œë“œ
//      * 
//      * @param InvateWorkspaceDTO ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ˆëŒ€ DTO
//      * @return
//      */
//     @Override
//     public ResultDTO<SuccessDTO> workspaseAdd(InvateWorkspaceDTO invateWorkspaceDTO) {
//         // í˜„ì¬ ë¡œê·¸ì¸í•œ ì•„ì´ë”” í™•ì¸
//         String email = AuthUtil.getLoginUserId();
//         // ì„œë²„ì—ì„œ ë³´ë‚¸ ì½”ë“œì™€ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì½”ë“œë¥¼ ì„œë¡œ ë¹„êµ
//         String code = redisTemplate.opsForValue().get("newWorkspace: " + email);
//         if (!code.equals(invateWorkspaceDTO.getCode())) {
//             throw new CustomException(ErrorCode.INVALID_EMAIL_CODE);
//         }
//         // DBì—ì„œ í˜„ì¬ ìœ ì €ì— ëŒ€í•œ ì •ë³´ë¥¼ ê°€ì ¸ì˜´
//         MemberEntity memberEntity = memberRepository.findById(email).get();
//         // DBì—ì„œ í˜„ì¬ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì— ëŒ€í•œ ì •ë³´ë¥¼ ê°€ì ¸ì˜´
//         WorkspaceEntity workspaceEntity = workspaceRepository.findById(invateWorkspaceDTO.getWsID()).get();
//         // DBì—ì„œ í˜„ì¬ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì±„ë„ ê¶Œí•œ ì¤‘ ê¸°ë³¸ ê¶Œí•œ ì •ë³´ë¥¼ ê°€ì ¸ì˜´
//         WorkspaceChannelRoleEntity workspaceRoleEntity = workspaceRoleRepository
//                 .findByWorkspace_wsIdAndChRole(invateWorkspaceDTO.getWsID(), "None").get();

//         // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë©¤ë²„ ì—”í‹°í‹°ì— ì €ì¥
//         WorkspaceMemberEntity workspaceMemberEntity = WorkspaceMemberEntity.builder()
//                 .workspace(workspaceEntity)
//                 .member(memberEntity)
//                 .wsRole("user")
//                 .chRoleNumber(workspaceRoleEntity)
//                 .nickname(memberEntity.getName())
//                 .profileImage(memberEntity.getProfileImage())
//                 .build();

//         workspaceMemberRepository.save(workspaceMemberEntity);

//         SuccessDTO successDTO = SuccessDTO.builder()
//                 .success(true)
//                 .build();
//         return ResultDTO.of("ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì¶”ê°€ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.", successDTO);
//     }

//     /**
//      * ì›Œí¬ìŠ¤í˜ì´ìŠ¤ íƒˆí‡´
//      * 
//      * @param wsName ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„
//      * @return
//      */
//     @Override
//     @Transactional
//     public ResultDTO<SuccessDTO> workspaceWithDrwal(Long wsId) {
//         // í˜„ì¬ ë¡œê·¸ì¸ í•œ ì´ë©”ì¼ì„ ë°›ìŒ
//         String email = AuthUtil.getLoginUserId();
//         // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ id ê²€ìƒ‰
//         // Long wsId = workspaceRepository.findWsIdByWsNameAndEmail(wsName, email);
//         // í•´ë‹¹ ë˜ëŠ” ë©¤ë²„ ì‚­ì œ
//         workspaceMemberRepository.deleteByWorkspace_wsIdAndMember_Email(wsId, email);

//         // í˜„ì¬ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì— ë©¤ë²„ê°€ ìˆë‚˜ í™•ì¸
//         List<WorkspaceMemberEntity> wM = workspaceMemberRepository.findByWorkspace_wsId(wsId);

//         // ë©¤ë²„ê°€ ì—†ìœ¼ë©´ í˜„ì¬ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì‚­ì œ
//         if (wM.isEmpty()) {
//             workspaceRepository.deleteById(wsId);
//         }

//         // ì„±ê³µì‹œ DTO ì €ì¥
//         SuccessDTO successDTO = SuccessDTO.builder()
//                 .success(true)
//                 .build();
//         // ê²°ê³¼ ë°˜í™˜
//         return ResultDTO.of("ì›Œí¬ìŠ¤í˜ì´ìŠ¤ íƒˆí‡´ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.", successDTO);
//     }

//     @Override
//     @Transactional
//     public ResultDTO<SuccessDTO> worksapceForceDrawal(Long wsId, String email) {
//         // í˜„ì¬ ë¡œê·¸ì¸ í•œ ì´ë©”ì¼ì„ ë°›ìŒ
//         String e = AuthUtil.getLoginUserId();

//         WorkspaceMemberEntity workspaceMemberEntity = workspaceMemberRepository
//                 .findByWorkspace_wsIdAndMember_Email(wsId, e).get();

//         // ê¶Œí•œ í™•ì¸
//         if (!workspaceMemberEntity.getWsRole().equals("owner")) {
//             // ì„±ê³µì‹œ DTO ì €ì¥
//             SuccessDTO successDTO = SuccessDTO.builder()
//                     .success(false)
//                     .build();
//             // ê²°ê³¼ ë°˜í™˜
//             return ResultDTO.of("í•´ë‹¹ ê¶Œí•œì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", successDTO);
//         }

//         // í•´ë‹¹ ë˜ëŠ” ë©¤ë²„ ì‚­ì œ
//         workspaceMemberRepository.deleteByWorkspace_wsIdAndMember_Email(wsId, email);

//         // ì„±ê³µì‹œ DTO ì €ì¥
//         SuccessDTO successDTO = SuccessDTO.builder()
//                 .success(true)
//                 .build();
//         // ê²°ê³¼ ë°˜í™˜
//         return ResultDTO.of("ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ê°•í‡´ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.", successDTO);
//     }

//     /**
//      * ì±„ë„ ê¶Œí•œ ìƒì„±
//      */
//     @Override
//     public ResultDTO<SuccessDTO> worksapceRightCreate(Long wsId, String newRole) {
//         WorkspaceEntity workspaceEntity = workspaceRepository.findById(wsId).get();
//         WorkspaceChannelRoleEntity workspaceChannelRoleEntity = WorkspaceChannelRoleEntity.builder()
//                 .workspace(workspaceEntity).chRole(newRole).build();
//         workspaceRoleRepository.save(workspaceChannelRoleEntity);
//         // ì„±ê³µì‹œ DTO ì €ì¥
//         SuccessDTO successDTO = SuccessDTO.builder()
//                 .success(true)
//                 .build();
//         // ê²°ê³¼ ë°˜í™˜
//         return ResultDTO.of("ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì±„ë„ ê¶Œí•œ ìƒì„±ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.", successDTO);
//     }

//     /**
//      * ì±„ë„ ê¶Œí•œ ë¶€ì—¬
//      */
//     @Override
//     @Transactional
//     public ResultDTO<SuccessDTO> worksapceRightGrant(Long wsId, String email, Long chRole) {
//         // í˜„ì¬ ë¡œê·¸ì¸ í•œ ì´ë©”ì¼ì„ ë°›ìŒ
//         String e = AuthUtil.getLoginUserId();
//         // í˜„ì¬ ë¡œê·¸ì¸ í•œ ìœ ì €ì˜ ê¶Œí•œ í™•ì¸
//         WorkspaceMemberEntity isOwner = workspaceMemberRepository
//                 .findByWorkspace_wsIdAndMember_Email(wsId, e).get();

//         // ê¶Œí•œ í™•ì¸
//         if (!isOwner.getWsRole().equals("owner")) {
//             // ì„±ê³µì‹œ DTO ì €ì¥
//             SuccessDTO successDTO = SuccessDTO.builder()
//                     .success(false)
//                     .build();
//             // ê²°ê³¼ ë°˜í™˜
//             return ResultDTO.of("í•´ë‹¹ ê¶Œí•œì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", successDTO);
//         }

//         // workspaceMember í…Œì´ë¸”ì—ì„œ í•´ë‹¹ ìœ ì € ê²€ìƒ‰
//         WorkspaceMemberEntity workspaceMemberEntity = workspaceMemberRepository
//                 .findByWorkspace_wsIdAndMember_Email(wsId, email).get();
//         // WorkspaceChannelRole í…Œì´ë¸”ì—ì„œ í•´ë‹¹ ê¶Œí•œ ê°€ì ¸ì˜¤ê¸°
//         WorkspaceChannelRoleEntity workspaceChannelRoleEntity = workspaceRoleRepository.findById(chRole).get();

//         workspaceMemberEntity.setChRoleNumber(workspaceChannelRoleEntity);
//         workspaceMemberRepository.save(workspaceMemberEntity);

//         // ì„±ê³µì‹œ DTO ì €ì¥
//         SuccessDTO successDTO = SuccessDTO.builder()
//                 .success(true)
//                 .build();
//         // ê²°ê³¼ ë°˜í™˜
//         return ResultDTO.of("ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì±„ë„ ê¶Œí•œ ë¶€ì—¬ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.", successDTO);
//     }

//     /**
//      * ì œëŒ€ë¡œ ì‘ë™ ì•ˆë¨!!!!!
//      * ë³´ë¥˜!!!!!!
//      * ì±„ë„ ê¶Œí•œ ì‚­ì œ
//      */
//     @Override
//     @Transactional
//     public ResultDTO<SuccessDTO> worksapceRightDelete(Long wsId, Long chRole) {
//         // í˜„ì¬ ë¡œê·¸ì¸ í•œ ì´ë©”ì¼ì„ ë°›ìŒ
//         String e = AuthUtil.getLoginUserId();
//         // í˜„ì¬ ë¡œê·¸ì¸ í•œ ìœ ì €ì˜ ê¶Œí•œ í™•ì¸
//         WorkspaceMemberEntity isOwner = workspaceMemberRepository
//                 .findByWorkspace_wsIdAndMember_Email(wsId, e).get();

//         // ê¶Œí•œ í™•ì¸
//         if (!isOwner.getWsRole().equals("owner")) {
//             // ì„±ê³µì‹œ DTO ì €ì¥
//             SuccessDTO successDTO = SuccessDTO.builder()
//                     .success(false)
//                     .build();
//             // ê²°ê³¼ ë°˜í™˜
//             return ResultDTO.of("í•´ë‹¹ ê¶Œí•œì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", successDTO);
//         }

//         // // í˜„ì¬ í•´ë‹¹ ê¶Œí•œì„ ê°€ì§€ê³  ìˆëŠ” ì‚¬ëŒë“¤ì´ ìˆëŠ”ê°€ í™•ì¸
//         // List<WorkspaceMemberEntity> workspaceMemberEntities = workspaceMemberRepository.findByWorkspace_wsId(wsId);

//         // workspaceMemberEntities.stream()
//         //         .filter(member -> member.getChRoleNumber() != null)
//         //         .filter(member -> member.getChRoleNumber().getChRoleNumber().equals(chRole))
//         //         .forEach(member -> member.setChRoleNumber(null));
        
//         // workspaceMemberRepository.saveAll(workspaceMemberEntities);

//         workspaceRoleRepository.deleteById(chRole);

//         // ì„±ê³µì‹œ DTO ì €ì¥
//         SuccessDTO successDTO = SuccessDTO.builder()
//                 .success(true)
//                 .build();
//         // ê²°ê³¼ ë°˜í™˜
//         return ResultDTO.of("ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì±„ë„ ê¶Œí•œ ì‚­ì œì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.", successDTO);
//     }
// }
